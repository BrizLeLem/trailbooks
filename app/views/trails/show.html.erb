<!-- MAP STYLESHEET -->
<link rel="stylesheet" href="https://api.mapbox.com/mapbox-gl-js/v1.12.0/mapbox-gl.css">
<!-- MAP -->
<div id="map" data-markers="<%= @markers.to_json %>" data-mapbox-api-key="<%= ENV['MAPBOX_API_KEY']%>">
  <div class="user-profile"></div>
  <h2 class="logo-on-map">
    <%= link_to root_path do %>
      TRAILBOOKS
    <% end %>
  </h2>
  <div data-controller="reservation">
    <div id="sidebar">
      <h1>
        <strong><%= @trail.name %></strong> | <%= @trail.country %>
      </h1>
      <div class="nav tabs-underlined" role="tablist">
        <a class="tab-underlined active" id="nav-itinerary-tab" data-toggle="tab" href="#nav-itinerary" role="tab" aria-controls="nav-itinerary" aria-selected="true">My Itinerary</a>
        <a class="tab-underlined" id="nav-trailstages-tab" data-toggle="tab" href="#nav-trailstages" role="tab" aria-controls="nav-trailstages" aria-selected="false">Trail Stages</a>
      </div>
      <div class="tab-content sidebar-tabs">
        <!-- ITINERARY TAB -->
        <div class="tab-pane fade show active" id="nav-itinerary" role="tabpanel" aria-labelledby="nav-itinerary-tab">
          <%= render "itinerary", reservations: @reservations %>
          <a href="#" class="btn-reserve">Reserve all</a>
        </div>
        <!-- TRAILSTAGES TAB -->
        <div class="tab-pane fade" id="nav-trailstages" role="tabpanel" aria-labelledby="nav-trailstages-tab">

          <% @trail.trail_stages.each do |ts| %>
            <% if ts.stage_number == 0 %>
            <!-- FIRST STAGE -->
              <div class="trailstage-container">
                <div class="icon-line">
                  <div class="marker-ts-start"></div>
                  <div class="vl-long"></div>
                </div>
                <p><%= ts.name %></p>
              </div>
            <% elsif ts.stage_number == (@trail.trail_stages.length - 1) %>
            <!-- FINAL STAGE -->
            <div class="trailstage-container">
                <div class="icon-line">
                  <%= image_tag("walk.svg") %>
                  <div class="vl-short"></div>
                </div>
                <div class="trailstage-stats">
                  <p id="distance"><%= ts.distance_from_last %>km</p>
                  <%= image_tag("ascend.svg") %>
                  <p><%= ts.ascend_from_last %>m</p>
                  <%= image_tag("descend.svg") %>
                  <p><%= ts.descend_from_last %>m</p>
                </div>
            </div>
            <div class="trailstage-container">
              <div class="icon-line">
                <div class="marker-ts-end"></div>
              </div>
              <p><%= ts.name %></p>
            </div>
            <% else %>
              <!-- MID STAGE -->
              <div class="trailstage-container">
                  <div class="icon-line">
                    <%= image_tag("walk.svg") %>
                    <div class="vl-short"></div>
                  </div>
                  <div class="trailstage-stats">
                    <p id="distance"><%= ts.distance_from_last %>km</p>
                    <%= image_tag("ascend.svg") %>
                    <p><%= ts.ascend_from_last %>m</p>
                    <%= image_tag("descend.svg") %>
                    <p><%= ts.descend_from_last %>m</p>
                  </div>
              </div>
              <div class="trailstage-container">
                <div class="icon-line">
                  <div class="mid-marker"><%= ts.stage_number %></div>
                  <div class="vl-long"></div>
                </div>
                <p><%= ts.name %></p>
              </div>
            <% end %>
          <% end %>
        </div>
      </div>
    </div>
    <div class="accommodation-container"><!-- ACCOMMODATION SHOW --></div>
  </div>
</div>
